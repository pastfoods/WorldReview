<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="'국가 리뷰 - ' + ${countryCode}">국가 리뷰</title>
</head>
<body>

<h2 th:text="'국가 코드: ' + ${countryCode}"></h2>

<p>
    평균 별점:
    <span th:text="${avgRating}">0.0</span> / 5.0
</p>

<hr>

<!-- 로그인한 사람만 리뷰 작성 -->
<div th:if="${loginUser != null}">
    <h3>리뷰 작성</h3>
    <form th:action="@{|/world/${countryCode}/review|}" method="post">
        <input type="hidden" name="userId" th:value="${loginUser.id}">
        <input type="hidden" name="countryCode" th:value="${countryCode}">

        <label>별점 (0.0 ~ 5.0):
            <input type="number" name="rating" step="0.1" min="0" max="5" required>
        </label>
        <br>

        <label>리뷰 내용:</label><br>
        <textarea name="content" rows="5" cols="60" required></textarea>
        <br>

        <button type="submit">작성</button>
    </form>
</div>

<div th:if="${loginUser == null}">
    <p>리뷰 작성 및 별점은 로그인 후 이용 가능합니다.</p>
</div>

<hr>

<h3>다른 사람들의 리뷰</h3>

<div th:if="${#lists.isEmpty(reviews)}">
    <p>아직 작성된 리뷰가 없습니다.</p>
</div>

<div th:each="review : ${reviews}">
    <div style="border:1px solid #ccc; padding:10px; margin-bottom:10px;">
        <p>
            <b th:text="${review.nickname}">닉네임</b>
            (<span th:text="${review.rating}">0.0</span> / 5.0)
        </p>

        <p th:text="${review.content}">내용</p>

        <p>
            <small th:text="${review.created}">작성일</small>
        </p>

        <!-- 작성자 본인만 수정/삭제 -->
        <div th:if="${loginUser != null and loginUser.id == review.userId}">
            <form th:action="@{|/world/review/${review.id}/update|}" method="post">
                <label>별점 수정:
                    <input type="number" name="rating" step="0.1" min="0" max="5"
                           th:value="${review.rating}">
                </label><br>

                <textarea name="content" rows="3" cols="50"
                          th:text="${review.content}"></textarea><br>

                <button type="submit">수정 저장</button>
            </form>

            <form th:action="@{|/world/review/${review.id}/delete|}" method="post">
                <button type="submit">삭제</button>
            </form>
        </div>
    </div>
</div>

<a href="/world">세계지도 페이지로</a>

</body>
</html>

