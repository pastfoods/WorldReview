<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>회원가입</title>

    <script>
        // 아이디 중복확인
        function checkUsername() {
            const username = document.getElementById("username").value;

            if (username.trim() === "") {
                alert("아이디를 입력하세요.");
                return;
            }

            fetch("/check-username?username=" + encodeURIComponent(username))
                .then(res => res.text())
                .then(data => {
                    const result = document.getElementById("checkResult");

                    if (data === "EXIST") {
                        result.style.color = "red";
                        result.textContent = "이미 사용 중인 아이디입니다.";
                    } else if (data === "OK") {
                        result.style.color = "green";
                        result.textContent = "사용 가능한 아이디입니다!";
                    } else {
                        // 예외 상황 (에러 페이지 등)
                        result.style.color = "orange";
                        result.textContent = "서버 오류가 발생했습니다.";
                    }
                })
                .catch(err => {
                    const result = document.getElementById("checkResult");
                    result.style.color = "orange";
                    result.textContent = "요청 중 오류가 발생했습니다.";
                });
        }
        function checkNickname() {
            const nickname = document.getElementById("nickname").value;

            if (nickname.trim() === "") {
              alert("닉네임을 입력하세요.");
              return;
            }

            fetch("/check-nickname?nickname=" + encodeURIComponent(nickname))
              .then(res => res.text())
              .then(data => {
                const result = document.getElementById("checkNickResult");

                if (data === "EXIST") {
                  result.style.color = "red";
                  result.textContent = "이미 사용 중인 닉네임입니다.";
                } else if (data === "OK") {
                  result.style.color = "green";
                  result.textContent = "사용 가능한 닉네임입니다!";
                } else {
                  result.style.color = "orange";
                  result.textContent = "서버 오류가 발생했습니다.";
                }
              })
              .catch(() => {
                const result = document.getElementById("checkNickResult");
                result.style.color = "orange";
                result.textContent = "요청 중 오류가 발생했습니다.";
              });
          }
    </script>
</head>
<body>

<h2>회원가입</h2>

<!-- 서버에서 전달한 에러 메시지 (예: 중복 아이디로 회원가입 실패) -->
<p th:if="${error}" th:text="${error}" style="color:red;"></p>

<form action="/signup" method="post">
  	<hr>
  	<div th:if="${nicknameError}" th:text="${nicknameError}" style="color:red;"></div>
  	<div th:if="${usernameError}" th:text="${usernameError}" style="color:red;"></div>
    <br>
    <!-- 아이디 -->
	<div>
  		<label>아이디 :
    		<input type="text" id="username" name="username" required th:value="${prevUsername}">
  		</label>
  		<button type="button" onclick="checkUsername()">중복확인</button>
  		<span id="checkResult"></span>
	</div>
    
    <!-- 비밀번호 -->
    <div>
        <label>비밀번호 :
            <input type="password" name="password" required>
        </label>
    </div>
    
	<!-- 닉네임 -->
	<div>
  		<label>닉네임 :
    		<input type="text" id="nickname" name="nickname" required th:value="${prevNickname}">
  		</label>
  		<button type="button" onclick="checkNickname()">중복확인</button>
 		<span id="checkNickResult"></span>
	</div>
	<br>
    <div>
        <button type="submit">회원가입</button>
    </div>
</form>

<hr>
<br>
<a href="/login">로그인으로 돌아가기</a>

</body>
</html>

